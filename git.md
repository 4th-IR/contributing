# Table of Contents

- [Git Commit Guidelines](#git-commit-guidelines)
- [Git Workflow](#git-workflow)

# Git Commit Guidelines
## This topic can be split into two areas of concern
1. The structured set/split of the code changes (i.e. what belongs to a single commit)
2. The format of the commit message and the information provided in it

## 1. Structural split of code changes into separate commits
The cardinal rule for creating good commits is to ensure there is only one "logical change" per commit. There are many reasons why this is an important rule:

- The smaller the amount of code being changed, the quicker & easier it is to review & identify potential flaws.
- If a change is found to be flawed later, it may be necessary to revert the broken commit. This is much easier to do if 
  there are not other unrelated code changes entangled with the original commit.
- When troubleshooting problems using Git's bisect capability, small well defined changes will aid in isolating exactly 
  where the code problem was introduced.
- When browsing history using Git annotate/blame, small well defined changes also aid in isolating exactly where & why a 
  piece of code came from.

### Common pitfalls to avoid
There are some commonly encountered examples of bad things to avoid
- Mixing whitespace (i.e. formatting, styling) changes with functional code changes.
- Mixing two unrelated functional changes.
- Sending large new features in a single giant commit.

## 2. How to write a good commit message
**Style.** Markup syntax, wrap margins, grammar, capitalization, punctuation.

**Content.** What kind of information should the body of the commit message (if any) contain? What should it not contain?

**Metadata.** How should issue tracking IDs, etc. be referenced?

### Seven basic rules of good commit messages:
1. Separate subject from body with a blank line
2. Limit the subject line to 50 characters
3. Capitalize the subject line
4. Do not end the subject line with a period
5. Use the imperative mode in the subject line
6. Wrap the body at 72 characters
7. Use the body to explain what and why vs. how

## Hereâ€™s a model Git commit message:
```
Summarize changes in around 50 characters or less

More detailed explanatory text, if necessary. Wrap it to 72 characters.
In some contexts, the first line is treated as the subject of an email
and the rest of the text as the body. The blank line separating
the summary from the body is critical; various tools like `log`,
`shortlog` and `rebase` can get confused if you run the two together.

Write your commit message in the imperative: "Fix bug" and not
"Fixed bug" or "Fixes bug." This convention matches up with commit
messages generated by commands like git merge and git revert.

Explain the problem that this commit is solving. Focus on why you
are making this change as opposed to how (the code explains that).
Are there side effects or other unintuitive consequences of this
change? Here's the place to explain them.

Further paragraphs can come after blank lines.

- Bullet points are okay, too
- Use hyphen for the bullet, followed by a single space
- Use a hanging indent when bullet points exceed the 72 character
  limit.

  Keep the indent if you want to use extra paragraphs inside
  a bullet point.

Put issue tracker (backlog item) references at the bottom, examples:

See: AB#456, AB#789
Fix: AB#123  # Links and transitions the work item to the "done" state
```

## Sources
https://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html<br>
https://wiki.openstack.org/wiki/GitCommitMessages<br>
https://chris.beams.io/posts/git-commit

[Back to Top](#table-of-contents)

# Git Workflow
## Contents
[How to set up your local repo](#how-to-set-up-your-local-repo)\
&nbsp;&nbsp;[1. Fork the organization repository](#1-fork-the-organization-repository)\
&nbsp;&nbsp;[2. Create a local clone of your fork](#2-create-a-local-clone-of-your-fork)\
&nbsp;&nbsp;[3. Set up a new remote pointing to the organization's repository](#3-set-up-a-new-remote-pointing-to-the-organizations-repository)\
&nbsp;&nbsp;[4. Set your local main branch to track \<remote-name\>/main](#4-set-your-local-main-branch-to-track-remote-namemain)\
[Development workflow](#development-workflow)\
&nbsp;&nbsp;[1. Use local feature branches](#1-use-local-feature-branches)\
&nbsp;&nbsp;[2. Do work](#2-do-work)\
&nbsp;&nbsp;[3. Commit your changes](#3-commit-your-changes)\
&nbsp;&nbsp;[4. Push your changes to your forked repository](#4-push-your-changes-to-your-forked-repository)\
&nbsp;&nbsp;[5. Open a Pull Request to merge your changes](#5-open-a-pull-request-to-merge-your-changes)\
&nbsp;&nbsp;[6. Merge your PR once approved](#6-merge-your-pr-once-approved)\
&nbsp;&nbsp;[7. Clean up your remote and local repositories](#7-clean-up-your-remote-and-local-repositories)\
&nbsp;&nbsp;[8. Sync \<remote-name\>/main to your local main](#8-sync-remote-namemain-to-your-local-main)\
[Basic Git commands](#basic-git-commands)

## How to set up your local repo

### 1. [Fork](https://help.github.com/articles/about-forks/) the organization repository

### 2. Create a local clone of your fork
```git
git clone <url>
``` 
Typical protocols that are used, and their url syntax with `GitHub`:\
HTTPS: `https://github.com/<username>/<repo-name>.git`\
SSH: `git@github.com:<username>/<repo-name>.git`
#### Example
username: pozsa\
repo-name: contributing\
method: ssh
```console
$ git clone git@github.com:pozsa/contributing.git
Cloning into 'contributing'...
remote: Counting objects: 10, done.
remote: Compressing objects: 100% (7/7), done.
remote: Total 10 (delta 1), reused 7 (delta 0), pack-reused 0
Receiving objects: 100% (10/10), done.
Resolving deltas: 100% (1/1), done.
Checking connectivity... done.
$ cd contributing/
$ git remote -v
origin  git@github.com:pozsa/contributing.git (fetch)
origin  git@github.com:pozsa/contributing.git (push)
```

### 3. Set up a new remote pointing to the organization's repository
```git
git remote add <remote-name> <url>
git fetch <remote-name>
```
where `<remote-name>` is traditionally set to `upstream`
#### Example
```console
$ git remote add upstream git@github.com:4th-IR/contributing.git
$ git remote -v
origin  git@github.com:pozsa/contributing.git (fetch)
origin  git@github.com:pozsa/contributing.git (push)
upstream        git@github.com:4th-IR/contributing.git (fetch)
upstream        git@github.com:4th-IR/contributing.git (push)
$ git fetch upstream
remote: Counting objects: 25, done.
remote: Compressing objects: 100% (14/14), done.
remote: Total 25 (delta 6), reused 20 (delta 5), pack-reused 0
Unpacking objects: 100% (25/25), done.
From github.com:4th-IR/contributing
 * [new branch]      main     -> upstream/main
```

### 4. Set your local main branch to track \<remote-name\>/main
```git
git branch -u <remote-name>/main
```
#### Example
```console
$ git branch -avv
* main                  4746caa [origin/main] Add link to wiki home page (#1)
  remotes/origin/HEAD     -> origin/main
  remotes/origin/main   4746caa Add link to wiki home page (#1)
  remotes/upstream/main 8a395a2 test access rights
$ git branch -u upstream/main
Branch main set up to track remote branch main from upstream.
$ git branch -avv
* main                  4746caa [upstream/main: behind 8] Add link to wiki home page (#1)
  remotes/origin/HEAD     -> origin/main
  remotes/origin/main   4746caa Add link to wiki home page (#1)
  remotes/upstream/main 8a395a2 test access rights
```

## Development workflow

### 1. Use local feature branches
... or as Enrico Campidoglio said
> Branch like there's no tomorrow

```git
git checkout -b <branch-name>
```
#### Example
```console
$ git checkout -b new_feature
Switched to a new branch 'new_feature'
```

### 2. Do work

### 3. Commit your changes
Write a [good commit message](#git-commit-guidelines)
```git
git add <file-01> <file-02>
git commit
```

### 4. Push your changes to your forked repository
```git
git push -u origin <branch-name>
```
#### Example
```console
$ git push origin new_feature
Counting objects: 30, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (24/24), done.
Writing objects: 100% (30/30), 378.12 KiB | 0 bytes/s, done.
Total 30 (delta 7), reused 3 (delta 0)
remote: Resolving deltas: 100% (7/7), done.
To git@github.com:pozsa/contributing.git
 * [new branch]      new_feature -> new_feature
```

### 5. Open a [Pull Request](https://help.github.com/articles/about-pull-requests/) to merge your changes
Flag team member(s) to review the pull request\
\# TODO: add guide on code review

### 6. Merge your PR once approved
Use `Squash and merge` if you have multiple commits in a PR to aid the PR review, but the end goal is to have a single commit in the main branch. In all other cases use `Rebase and merge`. More information [here](https://help.github.com/articles/about-pull-request-merges/).

### 7. Clean up your remote and local repositories
```git
git push origin --delete <branch-name>
git checkout main
git branch --delete <branch-name>
```
#### Example
```console
$ git push origin --delete new_feature
To git@github.com:pozsa/contributing.git
 - [deleted]         new_feature
$ git checkout main
Switched to branch 'main'
Your branch is behind 'upstream/main' by 9 commits, and can be fast-forwarded.
  (use "git pull" to update your local branch)
$ git branch --delete new_feature
error: The branch 'new_feature' is not fully merged.
If you are sure you want to delete it, run 'git branch -D new_feature'.
$ git branch -D new_feature
Deleted branch new_feature (was fb068ab).
```
#### Common Errors
The branch does not exist on the remote. It never existed to begin with or it has been already deleted.
```console
$ git push origin --delete cheatsheet
error: unable to delete 'cheatsheet': remote ref does not exist
error: failed to push some refs to 'git@github.com:pozsa/contributing.git'
```
Switch to a different branch to be able to delete a local branch
```console
$ git branch --delete new_feature
error: Cannot delete the branch 'new_feature' which you are currently on.
```
Git detects a potential situation where you might be losing work. If you are not sure that your changes have been merged, then investigate first.
```console
$ git branch --delete new_feature
error: The branch 'new_feature' is not fully merged.
If you are sure you want to delete it, run 'git branch -D new_feature'.
```

### 8. Sync \<remote-name\>/main to your local main
```git
git pull --rebase
```
#### Example
```console
$ git status
On branch main
Your branch is behind 'upstream/main' by 9 commits, and can be fast-forwarded.
  (use "git pull" to update your local branch)
$ git pull --rebase
First, rewinding head to replay your work on top of it...
Fast-forwarded main to fb068ab759dd5e972e50df9941f609061e7c07f2.
$ git status
On branch main
Your branch is up-to-date with 'upstream/main'.
nothing to commit, working directory clean
```

## Basic Git commands
- [git add](https://git-scm.com/docs/git-add) - Add file contents to the index (staging)
- [git branch](https://git-scm.com/docs/git-branch) - List, create, or delete branches
- [git checkout](https://git-scm.com/docs/git-checkout) - Switch branches or restore working tree files
- [git clone](https://git-scm.com/docs/git-clone) - Clone a repository into a new directory
- [git commit](https://git-scm.com/docs/git-commit) - Record changes to the repository
- [git diff](https://git-scm.com/docs/git-diff) - Show changes between commits, commit and working tree, etc
- [git fetch](https://git-scm.com/docs/git-fetch) - Download objects and refs from another repository
- [git merge](https://git-scm.com/docs/git-merge) - Join two or more development histories together
- [git pull](https://git-scm.com/docs/git-pull) - Fetch from and integrate with another repository or a local branch
- [git push](https://git-scm.com/docs/git-push) - Update remote refs along with associated objects
- [git rebase](https://git-scm.com/docs/git-rebase) - Reapply commits on top of another base tip
- [git remote](https://git-scm.com/docs/git-remote) - Manage set of tracked repositories
- [git status](https://git-scm.com/docs/git-status) - Show the working tree status

[Back to Top](#table-of-contents)
